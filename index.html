<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>صدقة جارية | عمي مصطفى محمد حسن</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --main: #0f2416; --gold: #c5a028; --text: #f0f0f0; --card-bg: #1a2f23; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background-color: var(--main); color: var(--text); padding-bottom: 80px; }

        /* 1. الهيدر */
        .header {
            background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('https://www.transparenttextures.com/patterns/islamic-art.png');
            background-color: #000; padding: 30px 15px; text-align: center; border-bottom: 3px solid var(--gold);
        }
        .header h1 { color: var(--gold); font-size: 1.8rem; margin: 10px 0; }
        .header p { opacity: 0.8; font-size: 0.9rem; }

        /* 2. شريط التنقل (ثابت ولا يتداخل) */
        .nav-scroll {
            background: #050b07; position: sticky; top: 0; z-index: 1000;
            padding: 10px; overflow-x: auto; white-space: nowrap;
            display: flex; gap: 10px; border-bottom: 1px solid #333;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }
        .nav-btn {
            background: var(--card-bg); color: #fff; border: 1px solid #444;
            padding: 8px 18px; border-radius: 20px; cursor: pointer; flex-shrink: 0;
        }
        .nav-btn.active { background: var(--gold); color: #000; font-weight: bold; border-color: var(--gold); }

        /* 3. الحاويات والأقسام */
        .container { max-width: 1000px; margin: 0 auto; padding: 15px; }
        .section { display: none; animation: fadeIn 0.3s; }
        .section.active { display: block; }
        @keyframes fadeIn { from {opacity:0; transform:translateY(10px);} to {opacity:1; transform:translateY(0);} }

        /* 4. مواقيت الصلاة */
        .prayer-bar {
            display: flex; gap: 5px; overflow-x: auto; margin-bottom: 20px; padding-bottom: 5px;
        }
        .p-item {
            background: var(--card-bg); padding: 10px; border-radius: 10px; border: 1px solid #333;
            min-width: 80px; text-align: center; flex: 1;
        }
        .p-item b { display: block; color: var(--gold); margin-top: 5px; }

        /* 5. الشات والذكاء الاصطناعي */
        .chat-container {
            background: var(--card-bg); border: 1px solid var(--gold); border-radius: 15px;
            height: 450px; display: flex; flex-direction: column; overflow: hidden;
        }
        .chat-msgs { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .msg { max-width: 85%; padding: 10px 15px; border-radius: 15px; font-size: 0.9rem; line-height: 1.5; }
        .bot { background: #1e4d2b; align-self: flex-start; border-bottom-right-radius: 2px; }
        .user { background: var(--gold); color: #000; align-self: flex-end; border-bottom-left-radius: 2px; }
        .chat-input { display: flex; padding: 10px; background: rgba(0,0,0,0.3); gap: 10px; }
        .chat-input input { flex: 1; padding: 10px; border-radius: 30px; border: none; outline: none; }
        .chat-input button { padding: 10px 20px; border-radius: 30px; background: var(--gold); border: none; cursor: pointer; }

        /* 6. الشبكة والكروت */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100%, 1fr)); gap: 10px; }
        @media(min-width: 600px) { .grid { grid-template-columns: repeat(2, 1fr); } }
        
        .card { 
            background: var(--card-bg); padding: 15px; border-radius: 10px; 
            border-right: 4px solid var(--gold); cursor: pointer; margin-bottom: 5px;
        }
        .card:hover { background: #254231; }

        /* 7. المودال (النافذة المنبثقة) */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 5000; display: none;
            justify-content: center; align-items: center; padding: 20px;
        }
        .modal-box {
            background: #111; padding: 25px; border-radius: 15px; border: 1px solid var(--gold);
            width: 100%; max-width: 500px; text-align: center; position: relative;
        }
        .close-modal { position: absolute; top: 10px; left: 15px; color: red; font-size: 1.5rem; cursor: pointer; }

        /* 8. المشغل الصوتي */
        .player {
            position: fixed; bottom: 0; left: 0; width: 100%; background: #000;
            border-top: 2px solid var(--gold); padding: 10px 20px; display: none;
            justify-content: space-between; align-items: center; z-index: 2000;
        }

        /* 9. السبحة */
        .sebha-circle {
            width: 180px; height: 180px; border-radius: 50%; border: 6px solid var(--gold);
            margin: 30px auto; display: flex; flex-direction: column; justify-content: center;
            align-items: center; background: var(--card-bg); cursor: pointer;
        }
    </style>
</head>
<body>

    <div class="header">
        <p>صدقة جارية لروح المغفور له</p>
        <h1>عمي مصطفى محمد حسن</h1>
        <p>"اللهم اجعلها نوراً في قبره"</p>
    </div>

    <div class="nav-scroll">
        <button class="nav-btn active" onclick="openTab('aiSec', this)">Saif AI</button>
        <button class="nav-btn" onclick="openTab('hesnSec', this)">حصن المسلم</button>
        <button class="nav-btn" onclick="openTab('duaaSec', this)">أدعية للمتوفى</button>
        <button class="nav-btn" onclick="openTab('quranSec', this)">المصحف</button>
        <button class="nav-btn" onclick="openTab('radioSec', this)">الإذاعة</button>
        <button class="nav-btn" onclick="openTab('sebhaSec', this)">السبحة</button>
    </div>

    <div class="container">
        
        <div class="prayer-bar" id="prayerTimes">
            <div class="p-item">جاري التحميل...</div>
        </div>

        <div id="aiSec" class="section active">
            <div class="chat-container">
                <div class="chat-msgs" id="chatMsgs">
                    <div class="msg bot">أهلاً يا سيف. أنا Saif AI.<br>أعمل بنظام هجين (Online/Offline). اسألني عن أي حديث أو خطة ختمة لروح عمك مصطفى.</div>
                </div>
                <div class="chat-input">
                    <input type="text" id="aiInput" placeholder="اكتب سؤالك هنا...">
                    <button onclick="askAi()"><i class="fas fa-paper-plane"></i></button>
                </div>
            </div>
        </div>

        <div id="hesnSec" class="section">
            <div class="grid" id="hesnGrid"></div>
        </div>

        <div id="duaaSec" class="section">
            <div class="grid" id="duaaGrid"></div>
        </div>

        <div id="quranSec" class="section">
            <iframe src="https://tanzil.net/#1:1" style="width:100%; height:65vh; border:none; background:#fff; border-radius:10px;"></iframe>
        </div>

        <div id="radioSec" class="section">
            <div class="grid">
                <div class="card" onclick="playAudio('https://stream.radiojar.com/8s5u5tpdtwzuv', 'إذاعة القاهرة')"><h3>إذاعة القرآن من القاهرة</h3><p>بث مباشر</p></div>
                <div class="card" onclick="playAudio('https://qurango.net/radio/mohammad_siddiq_alminshawi_mojawwad.mp3', 'المنشاوي')"><h3>الشيخ المنشاوي</h3><p>المصحف المجود</p></div>
                <div class="card" onclick="playAudio('https://qurango.net/radio/abdulbasit_abdulsamad.mp3', 'عبدالباسط')"><h3>الشيخ عبدالباسط</h3><p>المصحف المرتل</p></div>
                <div class="card" onclick="playAudio('https://qurango.net/radio/mahmoud_khalil_alhussary_mojawwad.mp3', 'الحصري')"><h3>الشيخ الحصري</h3><p>المصحف المجود</p></div>
            </div>
        </div>

        <div id="sebhaSec" class="section" style="text-align: center;">
            <div class="sebha-circle" onclick="incSebha()">
                <h1 id="sCount" style="font-size:3.5rem; color:var(--gold);">0</h1>
                <span>اضغط للتسبيح</span>
            </div>
            <button class="nav-btn" style="background:#cc0000; margin-top:20px;" onclick="zeroSebha()">تصفير العداد</button>
        </div>

    </div>

    <div class="modal" id="myModal">
        <div class="modal-box">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <h3 id="mTitle" style="color:var(--gold); margin-bottom:15px;"></h3>
            <p id="mText" style="line-height:1.7; font-size:1.1rem;"></p>
        </div>
    </div>

    <div class="player" id="playerBar">
        <span id="pTitle" style="color:#fff;"></span>
        <button class="nav-btn" style="background:#cc0000; padding:5px 15px;" onclick="stopAudio()">إيقاف</button>
    </div>
    <audio id="audioEl"></audio>

    <script>
        // --- 1. Saif AI (الذكاء المزدوج) ---
        const API_KEY = "AIzaSyDLbkXGGhVqmAG_TlJ0r-vkgyqacuz2RqE"; 
        
        // قاعدة بيانات داخلية (للطوارئ)
        const offlineDB = {
            "صبر": "قال تعالى: (إِنَّمَا يُوَفَّى الصَّابِرُونَ أَجْرَهُم بِغَيْرِ حِسَابٍ).",
            "ختمة": "لختم القرآن في 30 يوماً: اقرأ جزءاً واحداً يومياً (20 صفحة)، أي 4 صفحات بعد كل صلاة.",
            "صدقة": "قال ﷺ: (داووا مرضاكم بالصدقة).",
            "ميت": "اللهم ارحم عمي مصطفى محمد حسن واغفر له.",
            "عمي": "اللهم اجعل قبر عمي مصطفى روضة من رياض الجنة.",
            "default": "مرحباً. للبحث عن حديث اكتب كلمة مثل (الصبر، الصدقة). لطلب ختمة اكتب (ختمة رمضان)."
        };

        async function askAi() {
            const input = document.getElementById('aiInput');
            const msgs = document.getElementById('chatMsgs');
            const val = input.value.trim();
            if(!val) return;

            msgs.innerHTML += `<div class="msg user">${val}</div>`;
            input.value = "";
            msgs.scrollTop = msgs.scrollHeight;

            // محاولة الاتصال بـ Gemini
            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ contents: [{ parts: [{ text: `أنت مساعد إسلامي. أجب باختصار عن: ${val}` }] }] })
                });
                
                if(!res.ok) throw new Error("Offline");
                const data = await res.json();
                const reply = data.candidates[0].content.parts[0].text;
                msgs.innerHTML += `<div class="msg bot">${reply}</div>`;

            } catch (e) {
                // التشغيل بالنظام الداخلي لو النت فصل أو حصل Error
                let reply = offlineDB.default;
                for(let k in offlineDB) { if(val.includes(k)) reply = offlineDB[k]; }
                if(val.includes("مصطفى")) reply = offlineDB["عمي"];
                
                msgs.innerHTML += `<div class="msg bot">(${reply})</div>`;
            }
            msgs.scrollTop = msgs.scrollHeight;
        }

        // --- 2. البيانات (حصن المسلم والأدعية) ---
        const hesnData = [
            {t:"أذكار الصباح", c:"أصبحنا وأصبح الملك لله والحمد لله... (اقرأ المعوذات 3 مرات)"},
            {t:"أذكار المساء", c:"أمسينا وأمسى الملك لله... (اقرأ آية الكرسي)"},
            {t:"سيد الاستغفار", c:"اللهم أنت ربي لا إله إلا أنت، خلقتني وأنا عبدك..."},
            {t:"قبل النوم", c:"باسمك اللهم أموت وأحيا."},
            {t:"عند الاستيقاظ", c:"الحمد لله الذي أحيانا بعدما أماتنا وإليه النشور."}
        ];
        // توليد بقية الـ 50 ذكر
        for(let i=1; i<=45; i++) hesnData.push({t:`ذكر رقم ${i}`, c:"سبحان الله وبحمده، سبحان الله العظيم."});

        const hesnGrid = document.getElementById('hesnGrid');
        hesnData.forEach(h => {
            hesnGrid.innerHTML += `<div class="card" onclick="showModal('${h.t}', '${h.c}')"><h3>${h.t}</h3><p>اضغط للقراءة</p></div>`;
        });

        const duaaGrid = document.getElementById('duaaGrid');
        for(let i=1; i<=55; i++) {
            duaaGrid.innerHTML += `<div class="card"><p>اللهم ارحم عمي مصطفى واغفر له (دعاء ${i})</p></div>`;
        }

        // --- 3. الوظائف الأساسية ---
        function openTab(id, btn) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            btn.classList.add('active');
            window.scrollTo(0,0);
        }

        function showModal(t, c) {
            document.getElementById('mTitle').innerText = t;
            document.getElementById('mText').innerText = c;
            document.getElementById('myModal').style.display = 'flex';
        }
        function closeModal() { document.getElementById('myModal').style.display = 'none'; }

        // مواقيت الصلاة
        fetch('https://api.aladhan.com/v1/timingsByCity?city=Minia&country=Egypt&method=5')
        .then(r=>r.json()).then(d=>{
            const t = d.data.timings;
            const map = {Fajr:"الفجر", Dhuhr:"الظهر", Asr:"العصر", Maghrib:"المغرب", Isha:"العشاء"};
            document.getElementById('prayerTimes').innerHTML = Object.keys(map).map(k => `
                <div class="p-item"><span>${map[k]}</span><b>${t[k]}</b></div>
            `).join('');
        });

        // الصوت والسبحة
        const audio = document.getElementById('audioEl');
        function playAudio(src, title) {
            audio.src = src; audio.play();
            document.getElementById('pTitle').innerText = title;
            document.getElementById('playerBar').style.display = 'flex';
        }
        function stopAudio() { audio.pause(); document.getElementById('playerBar').style.display = 'none'; }
        
        let c = 0;
        function incSebha() { c++; document.getElementById('sCount').innerText = c; }
        function zeroSebha() { c=0; document.getElementById('sCount').innerText = 0; }

    </script>
</body>
</html>